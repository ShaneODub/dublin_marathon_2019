glimpse(all.results)
unique(all.results$Category)
unique(all.results$Category)
all.results$Category <-
all.results$Category %>%
str_remove("[MF]") %>%
str_replace("U19","18") %>%
str_replace("S","20")
library(tidyverse)
all.results$Category <-
all.results$Category %>%
str_remove("[MF]") %>%
str_replace("U19","18") %>%
str_replace("S","20")
unique(all.results$Category)
# Change all the time columns to hms. It will NA the blanks at the same time.
all.results[,4:9] <- lapply(all.results[,4:9], as_hms)
library(hms)
# Change all the time columns to hms. It will NA the blanks at the same time.
all.results[,4:9] <- lapply(all.results[,4:9], as_hms)
# Gender and Category column as factors
all.results$Gender <- as.factor(all.results$Gender)
all.results$Category <- as.factor(all.results$Category)
glimpse(all.results)
glimpse(all.results)
# Let's start with the 10k checkpoint times
all.results %>% filter(is.na(X10K)) %>% View()
all.results %>%
filter(is.na(X10K) & count_na %in% c(2,3)) %>%
View()
# Create a function count_na to count the NAs across the checkpoint columns...
count_na <- function(x) sum(is.na(x[4:7]))
all.results <-
all.results %>%
mutate(count_na = apply(., 1, count_na))
# Let's start with the 10k checkpoint times
all.results %>% filter(is.na(X10K)) %>% View()
all.results %>%
filter(is.na(X10K) & count_na %in% c(2,3)) %>%
View()
all.results <-
all.results %>%
filter(!
(is.na(X10K) & (count_na %in% c(2,3)))
)
all.results %>%
filter(is.na(X20K) & (count_na == 2)) %>%
View()
# There's just a few. Getting rid.
all.results <-
all.results %>%
filter(!
(is.na(X20K) & (count_na == 2))
)
# Having a look at runners who missed 30k chkpt and 40k chkpt:
all.results %>%
filter(is.na(X30K) & (count_na == 2)) %>%
View()
all.results %>%
filter(is.na(X30K) & (count_na == 2) & Overall.Position != "DNF") %>%
View()
#Getting rid of these:
all.results <-
all.results %>%
filter(!
(is.na(X30K) & (count_na == 2) & Overall.Position != "DNF")
)
all.results %>%
filter(!is.na(Gun.Time) & (count_na >= 2)) %>%
View()
all.results <-
all.results %>%
filter(!
(!is.na(Gun.Time) & (count_na >= 2))
)
all.results %>%
filter(!is.na(Gun.Time) & (count_na >= 2)) %>%
View()
all.results %>%
filter(!is.na(Chip.Time)) %>%
View()
all.results %>%
filter(is.na(Chip.Time)) %>%
View()
all.results %>%
filter(is.na(Chip.Time) & Overall.Position != "DNF") %>%
View()
all.results %>%
filter(is.na(Chip.Time) & Overall.Position != "DNF") %>%
.$Gun.Time %>%
View()
all.results$Chip.Time[is.na(Chip.Time) & Overall.Position != "DNF"]
all.results$Chip.Time[is.na(all.results$Chip.Time) & all.results$Overall.Position != "DNF"]
all.results2 %>%
filter(is.na(Chip.Time) & Overall.Position != "DNF") %>%
.$Chip.Time <-
all.results %>%
filter(is.na(Chip.Time) & Overall.Position != "DNF") %>%
.$Gun.Time
all.results %>%
filter(is.na(Chip.Time) & Overall.Position != "DNF") %>%
.$Chip.Time <-
all.results %>%
filter(is.na(Chip.Time) & Overall.Position != "DNF") %>%
.$Gun.Time
all.results$Chip.Time[is.na(all.results$Chip.Time)]
all.results$Gun.Time[is.na(all.results$Chip.Time)]
source('C:/Users/Shane/projects/marathon/clean_script.R', echo=TRUE)
all.results$Gun.Time[is.na(all.results$Chip.Time)] %>% View()
all.results$Chip.Time[is.na(all.results$Chip.Time)] <-
all.results$Gun.Time[is.na(all.results$Chip.Time)]
all.results %>%
filter(Overall.Position != "DNF") %>%
View()
summary(all.results)
View(list.of.dataframes)
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
View()
View(all.results[ia.na(all.results$X10K) & all.results$count_na == 1,])
View(all.results[is.na(all.results$X10K) & all.results$count_na == 1,])
all.results[1,4]
all.results[1,4]/2
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
mutate(X10K = apply(., 1, impute10))
impute10 <- function (X) x["X20K"/2]
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
mutate(X10K = apply(., 1, impute10))
impute10 <- function (X) x["X20K"]/2
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
mutate(X10K = apply(., 1, impute10))
all.results %>%
filter(is.na(X10K) & count_na == 1)
impute10 <- function (X) x$X20K/2
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
mutate(X10K = apply(., 1, impute10))
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
mutate(X10K = X20K/2)
# First, converting all time columns to numerics.
glimpse(all.results)
glimpse(all.results)
all.results %>%
lapply(., mutate_if, is_hms, as.numeric)
lapply(all.results.df[,4:9], as.numeric)
lapply(all.results[,4:9], as.numeric)
lapply(all.results[,4:9], as.numeric)/60
all.results[,4:9]  %>%
lapply(as.numeric)
all.results[,4:9]  %>%
as.numeric()
all.results[,4:9]  %>%
lapply(as.numeric) %>%
divide_by(60)
all.results[,4:9]  %>%
lapply(as.numeric) %>%
lapply(divide_by(60))
all.results[,4:9]  %>%
as.numeric
all.results[,4:9]  %>%
lapply(as.numeric) %>%
lapply("/",60)
all.results[,4:9] <-
all.results[,4:9]  %>%
lapply(as.numeric) %>%
lapply("/",60)
glimpse(all.results)
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
View()
# 54 results
summary(all.results)
summary(all.results[,4:9])
summary(all.results[all.results$count_na = 1][,4:9])
summary(all.results[all.results$count_na == 1][,4:9])
summary(all.results[all.results$count_na == 1,][,4:9])
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
Summary()
# 54 results
# Have a look at the rows where only the 10K checkpoint is blank
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
Summary
# 54 results
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
summarise_()
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
summarise()
summary(all.results %>%
filter(is.na(X10K) & count_na == 1))
summary(all.results[,4:9] %>%
filter(is.na(X10K) & count_na == 1))
summary(all.results %>%
filter(is.na(X10K) & count_na == 1))
summary(all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
select(4:9))
summary(all.results %>%
filter(count_na == 1) %>%
select(4:9))
summary(all.results %>%
filter(count_na == 1 & Overall.Position != "DNF") %>%
select(4:9))
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
View()
# 54 results
summary(all.results %>%
filter(count_na == 1 & is.na(Gun.Time)) %>%
select(4:9))
summary(all.results %>%
filter(count_na == 1 & !is.na(Gun.Time)) %>%
select(4:9))
summary(all.results %>%
filter(count_na == 1) %>%
select(4:9))
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
mutate(X10K = X20K/2)
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
mutate(X10K = X20K/1.98)
all.results <-
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
mutate(X10K = X20K/1.98)
u
all.results <- bind_rows(list.of.dataframes)
all.results <-
list.of.dataframes %>%
lapply(., mutate_if, is.integer, as.character) %>%
bind_rows()
list.of.dataframes <- readRDS(choose.files())
all.results <-
list.of.dataframes %>%
lapply(., mutate_if, is.integer, as.character) %>%
bind_rows()
all.results <- select(all.results,1,4,6,10,12,16,18,20,22,21)
all.results <- as_tibble(all.results)
all.results$Category <-
all.results$Category %>%
str_remove("[MF]") %>%
str_replace("U19","18") %>%
str_replace("S","20")
all.results[,4:9] <-
all.results[,4:9]  %>%
lapply(as.numeric) %>%
lapply("/",60)
all.results <-
list.of.dataframes %>%
lapply(., mutate_if, is.integer, as.character) %>%
bind_rows()
# Keeping just the columns I plan to use
all.results <- select(all.results,1,4,6,10,12,16,18,20,22,21)
all.results <- as_tibble(all.results)
all.results$Category <-
all.results$Category %>%
str_remove("[MF]") %>%
str_replace("U19","18") %>%
str_replace("S","20")
# Change all the time columns from strings to hms. It will NA the blanks at the same time.
all.results[,4:9] <- lapply(all.results[,4:9], as_hms)
all.results[,4:9] <-
all.results[,4:9]  %>%
lapply(as.numeric) %>%
lapply("/",60)
all.results$Gender <- as.factor(all.results$Gender)
all.results$Category <- as.factor(all.results$Category)
glimpse(all.results)
count_na <- function(x) sum(is.na(x[4:7]))
# ...and put the results in a new column callled count_na
all.results <-
all.results %>%
mutate(count_na = apply(., 1, count_na))
glimpse(all.results)
all.results %>%
filter(is.na(X10K)) %>%
View()
# 149 results.
all.results %>%
filter(is.na(X10K) & count_na %in% c(2,3)) %>%
View()
# 57 results
all.results <-
all.results %>%
filter(!
(is.na(X10K) & (count_na %in% c(2,3)))
)
all.results %>%
filter(is.na(X20K) & (count_na == 2)) %>%
View()
all.results <-
all.results %>%
filter(!
(is.na(X20K) & (count_na == 2))
)
all.results %>%
filter(is.na(X30K) & (count_na == 2)) %>%
View()
all.results %>%
filter(is.na(X30K) & (count_na == 2) & Overall.Position != "DNF") %>%
View()
# 13 runners.
#Getting rid of these:
all.results <-
all.results %>%
filter(!
(is.na(X30K) & (count_na == 2) & Overall.Position != "DNF")
)
all.results %>%
filter(!is.na(Gun.Time) & (count_na >= 2)) %>%
View()
all.results <-
all.results %>%
filter(!
(!is.na(Gun.Time) & (count_na >= 2))
)
all.results %>%
filter(is.na(Chip.Time)) %>%
View()
# In some cases it's because they didn't finish. Filter without the DNF runners.
all.results %>%
filter(is.na(Chip.Time) & Overall.Position != "DNF") %>%
View()
# 81 results.
all.results$Chip.Time[is.na(all.results$Chip.Time)] <-
all.results$Gun.Time[is.na(all.results$Chip.Time)]
glimpse(all.results)
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
View()
# 54 results
summary(all.results %>%
filter(count_na == 1) %>%
select(4:9))
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
mutate(X10K = X20K/1.98) %>%
.$X10K
saveRDS(all.results, file = "all.results")
saveRDS(all.results, file = "all.results.rds")
all.results %>%
mutate_if(.,is.na(X10K) & count_na == 1,X20K/1.98) %>%  View()
all.results %>%
mutate_if(.,is.na(.$X10K) & count_na == 1,X20K/1.98) %>%  View()
all.results %>%
mutate_if(.,is.na(.$X10K) & .$count_na == 1,X20K/1.98) %>%  View()
all.results %>%
mutate_if(.,is.na(.$X10K) & .$count_na == 1,.$X20K/1.98) %>%  View()
all.results %>%
apply(.,1,function (x) if (is.na(x$X10K) & x$count_na == 1) {x$X10K <- x$X20K/1.98})
all.results %>%
apply(.,1,function (x) if (is.na(X10K) & x$count_na == 1) {x$X10K <- x$X20K/1.98})
all.results %>%
apply(.,1,function (x) if (is.na(X10K) & x$count_na == 1) {x$X10K <- x$X20K/1.98})
glimpse(all.results)
all.results %>%
apply(.,1,function (x) if (is.na(x[4]) & x[11] == 1) {x[4] <- x[5]/1.98})
all.results %>%
apply(.,1,function (x) if (is.na(x[4]) & x[11] == 1) {x[4] <- x[5]/})
all.results %>%
apply(.,1,function (x) if (is.na(x[4]) & x[11] == 1) {x[4] <- x[5]})
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
mutate(X10K = X20K/1.98) %>%
all.results %>%
filter(is.na(X10K) & count_na == 1) %>%
mutate(X10K = X20K/1.98)
all.results %>%
mutate(X10K = if_else(is.na(X10K) & count_na == 1,X20K,X10K))
all.results %>%
mutate(X10K = if_else(is.na(X10K) & count_na == 1, X20K/1.98, X10K))
all.results[c(7507,8336,4454),] %>%
mutate(X10K = if_else(is.na(X10K) & count_na == 1, X20K/1.98, X10K)) %>% View()
glimpse(all.results)
all.results[c(7507,8336,4454),] <-
all.results[c(7507,8336,4454),] %>%
mutate(X10K = if_else(is.na(X10K) & count_na == 1, X20K/1.98, X10K))
all.results[c(7507,8336,4454),] %>% View()
all.results %>% View()
all.results[c(7507,8336,4454),]$X10K
all.results[c(7507,8336,4454),]$X10K <- NA
all.results[c(7507,8336,4454),]$X10K
all.results[all.results$Race.Number %in% c(7507,8336,4454),] <-
all.results[all.results$Race.Number %in% c(7507,8336,4454),] %>%
mutate(X10K = if_else(is.na(X10K) & count_na == 1, X20K/1.98, X10K))
all.results[all.results$Race.Number %in% c(7507,8336,4454),]
all.results <-
all.results %>%
mutate(X10K = if_else(is.na(X10K) & count_na == 1, X20K/1.98, X10K))
summary(all.results %>%
filter(count_na == 1) %>%
select(4:9))
all.results[all.results$Race.Number %in% c(2021,19358,19530),]
all.results[all.results$Race.Number %in% c(20921,19358,19530),]
all.results[all.results$Race.Number %in% c(20921,19358,19530),] <-
all.results[all.results$Race.Number %in% c(20921,19358,19530),] %>%
mutate(X20K = if_else(is.na(X20K) & count_na == 1,0.48*(X30K - X10K), X20K))
all.results[all.results$Race.Number %in% c(20921,19358,19530),]
all.results[all.results$Race.Number %in% c(20921,19358,19530),]$X20K
all.results[all.results$Race.Number %in% c(20921,19358,19530),]$X20K <- NA
all.results[all.results$Race.Number %in% c(20921,19358,19530),]
all.results[all.results$Race.Number %in% c(20921,19358,19530),] <-
all.results[all.results$Race.Number %in% c(20921,19358,19530),] %>%
mutate(X20K = if_else(is.na(X20K) & count_na == 1,X10K + 0.48*(X30K - X10K), X20K))
all.results[all.results$Race.Number %in% c(20921,19358,19530),]
all.results <-
all.results %>%
mutate(X20K = if_else(is.na(X20K) & count_na == 1, X10K + 0.48*(X30K - X10K), X20K))
summary(all.results %>%
filter(count_na == 1) %>%
select(4:9))
all.results <-
all.results %>%
mutate(X30K = if_else(is.na(X30K) & count_na == 1, X20K + 0.44*(X40K - X20K), X30K))
summary(all.results %>%
filter(count_na == 1) %>%
select(4:9))
all.results %>%
mutate(X40K = if_else(is.na(X40K) & count_na == 1 & Overall.Position != DNF,
X30K + 0.79*(Chip.Time - X30K),
X40K)) %>% View()
all.results %>%
mutate(X40K = if_else(is.na(X40K) & count_na == 1 & Overall.Position != "DNF",
X30K + 0.79*(Chip.Time - X30K),
X40K)) %>% View()
all.results <-
all.results %>%
mutate(X40K = if_else(is.na(X40K) & count_na == 1 & Overall.Position != "DNF",
X30K + 0.79*(Chip.Time - X30K),
X40K))
summary(all.results %>%
filter(count_na == 1) %>%
select(4:9))
summary(all.results %>%
filter(count_na == 1 & Overall.Position != "DNF") %>%
select(4:9))
saveRDS(all.results, file = "all.results.rds")
rename(all.results, Category = Age.Bracket) %>% View()
dplyr::rename(all.results, Category = Age.Bracket) %>% View()
rename(all.results, c("Category" = "Age.Bracket"))
all.results  <-
rename(all.results, c("Category" = "Age.Bracket"))
library(dplyr)
all.results %>%
mutate(split_1 = X10K,
split_2 = X20K - X10K,
split_3 = X30K - X20K,
split_4 = X40K - X30K) %>% View()
splits <-
all.results %>%
mutate(split_1 = X10K,
split_2 = X20K - X10K,
split_3 = X30K - X20K,
split_4 = X40K - X30K)
class(splits)
glimpse(splits)
glimpse(all.results)
pairs(splits[,12:15])
cor(splits[,12:15])
cor(splits[,12:15], na.rm = T)
cor(splits[,12:15], use = "complete.obs")
View(splits)
summary(splits[,12:15])
ggplot(splits[,12:15], mapping = aes(split_1,split_4, colour = Gender)) + geom_point()
ggplot(splits[,12:15], mapping = aes(split_1,split_4, colour = "Gender")) + geom_point()
ggplot(splits[,12:15], mapping = aes(split_1,split_4, colour = "Gender")) +
geom_point() +
ylim(0,150) +
xlim(0,150)
ggplot(splits[,12:15], mapping = aes(split_1,split_4, colour = "Gender")) +
geom_point() +
ylim(0,150) +
xlim(0,150) +
abline(0,1)
ggplot(splits[,12:15], mapping = aes(split_1,split_4, colour = "Gender")) +
geom_point() +
ylim(0,150) +
xlim(0,150) +
geom_segment(aes(0,0,150,150))
ggplot(splits, mapping = aes(split_1,split_4, colour = "Gender")) +
geom_point() +
ylim(0,150) +
xlim(0,150) +
geom_segment(aes(0,0,xend = 150, yend = 150))
ggplot(splits, mapping = aes(split_1,split_2, colour = Gender)) +
geom_point(size = 0.6) +
ylim(0,150) +
xlim(0,150) +
geom_segment(aes(0,0,xend = 150, yend = 150))
ggplot(splits, mapping = aes(split_1,split_4, colour = Gender)) +
geom_point(size = 0.6) +
ylim(0,150) +
xlim(0,150) +
geom_segment(aes(0,0,xend = 150, yend = 150))
ggplot(splits, mapping = aes(split_1,split_4, colour = Gender)) +
geom_point(size = 0.4, na.rm = T) +
ylim(0,150) +
xlim(0,150) +
geom_segment(aes(0,0,xend = 150, yend = 150))
ggplot(splits, mapping = aes(split_3,split_4, colour = Gender)) +
geom_point(size = 0.4, na.rm = T) +
ylim(0,150) +
xlim(0,150) +
geom_segment(aes(0,0,xend = 150, yend = 150))
